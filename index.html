<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 3: Design Studio</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .progress-bar {
            transition: width 0.3s ease;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slider-container input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #e5e7eb;
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }
        
        .slider-container input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }
        
        .score-bar {
            height: 24px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        @media print {
            body * {
                visibility: hidden;
            }
            #printable-document, #printable-document * {
                visibility: visible;
            }
            #printable-document {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Utility Functions
        const generateSessionId = () => {
            const date = new Date();
            const dateStr = date.toISOString().slice(0,10).replace(/-/g, '');
            const timeStr = date.toTimeString().slice(0,5).replace(/:/g, '');
            const random = Math.random().toString(36).substring(2, 8).toUpperCase();
            return `M3-${dateStr}-${timeStr}-${random}`;
        };

        const calculateDesignScore = (design, expertDesign) => {
            let score = 0;
            
            // Correct intervention level (25 points)
            if (design.interventionLevel === expertDesign.interventionLevel) {
                score += 25;
            }
            
            // Pattern appropriateness (25 points)
            // Check how many correct patterns selected vs incorrect
            const correctPatterns = design.patterns.filter(p => 
                expertDesign.recommendedPatterns.includes(p)
            ).length;
            const incorrectPatterns = design.patterns.filter(p => 
                !expertDesign.recommendedPatterns.includes(p)
            ).length;
            const patternScore = Math.max(0, (correctPatterns * 10) - (incorrectPatterns * 5));
            score += Math.min(25, patternScore);
            
            // Beauty scores reasonableness (25 points)
            // Check if within 20 points of expert ranges
            const beautyScores = ['legibility', 'capacityRevealing', 'authenticity', 'implementability'];
            let beautyTotal = 0;
            beautyScores.forEach(dimension => {
                const diff = Math.abs(design.beautyScores[dimension] - expertDesign.beautyRanges[dimension][0]);
                const range = expertDesign.beautyRanges[dimension][1] - expertDesign.beautyRanges[dimension][0];
                if (diff <= range) {
                    beautyTotal += 6.25;
                }
            });
            score += beautyTotal;
            
            // Risk awareness (25 points)
            const risksIdentified = design.risks.length;
            const riskScore = Math.min(25, risksIdentified * 8);
            score += riskScore;
            
            return Math.round(score);
        };

        const determineSkillLevel = (accuracy) => {
            if (accuracy >= 85) return 'Proficient';
            if (accuracy >= 70) return 'Developing';
            return 'Novice';
        };

        // Expert Intervention Designs
        const EXPERT_DESIGNS = {
            case1: {
                interventionLevel: 'context',
                recommendedPatterns: ['workload', 'autonomy', 'support'],
                beautyRanges: {
                    legibility: [80, 90],
                    capacityRevealing: [70, 85],
                    authenticity: [85, 95],
                    implementability: [50, 70]
                },
                expertDescription: 'Hire additional nurses to achieve 4-5 patient ratio (best practice standard). Implement mandatory break protocols and eliminate non-essential paperwork. Create peer support groups for processing moral injury. Restore regular staff meetings for coordination and voice.',
                reasoning: 'This is a capacity suppression problem requiring context redesign. The nurses have demonstrated capacity for compassion - they chose this profession and show empathy elsewhere. The context (impossible workloads, chronic stress, moral injury) is suppressing that capacity. No amount of training will help. We must change the context: reduce stressors, restore autonomy, build support systems.',
                commonMistake: 'Students often want to add "compassion training" or "mindfulness programs." But training is a capability-level intervention for a capacity-level problem. It blames individuals for systemic failures and wastes resources while leaving root causes intact.',
                implementationNotes: 'Biggest challenge is budget/political resistance. Build business case around retention costs, quality outcomes, and liability. Start with pilot unit to demonstrate effectiveness. Document process for institutional memory (constructor level).'
            },
            case2: {
                interventionLevel: 'capability',
                recommendedPatterns: ['specifications', 'training', 'protocols'],
                beautyRanges: {
                    legibility: [85, 95],
                    capacityRevealing: [70, 80],
                    authenticity: [75, 85],
                    implementability: [75, 90]
                },
                expertDescription: 'Develop clear ethics decision protocols for common scenarios (promotion criteria, harassment response steps, performance evaluation rubrics). Create training program with role-play practice and scenario testing. Implement peer consultation system for complex cases. Establish ethics helpline for real-time guidance.',
                reasoning: 'This is a capability gap problem. People want to be ethical (capacity exists) but lack reliable methods. Abstract principles don\'t translate to action - "be fair" doesn\'t tell you HOW to choose between qualified candidates. They need clear specifications, practiced skills, and support systems for implementation.',
                commonMistake: 'Students might propose another "ethics training" with more inspiring talks. But the first training failed because it was abstract. Or they might jump to "change the culture" (constructor level) - but you can\'t institutionalize capabilities that don\'t exist yet.',
                implementationNotes: 'This is highly implementable - doesn\'t require massive resources or culture change, just systematic specification and training. Start with highest-impact scenarios. Build capability before trying to institutionalize it.'
            },
            case3: {
                interventionLevel: 'constructor',
                recommendedPatterns: ['documentation', 'training', 'rituals', 'succession'],
                beautyRanges: {
                    legibility: [75, 85],
                    capacityRevealing: [60, 75],
                    authenticity: [70, 85],
                    implementability: [70, 85]
                },
                expertDescription: 'Create comprehensive documentation of ethical decision-making frameworks and past case resolutions. Establish formal ethics committee with rotating membership and clear decision protocols. Institute quarterly ethics training for all staff with case study review. Develop ethics mentoring program pairing experienced and new employees. Build ethical decision-making into formal rituals (kickoff meetings, project reviews, exit interviews).',
                reasoning: 'This is a constructor failure. The practices worked but lived entirely in the founder\'s head. When she left, the knowledge left too. The solution is institutionalization - making patterns persist independent of individuals through documentation, training systems, rituals, and distributed ownership.',
                commonMistake: 'Students might focus on "finding someone like Maya" or "training the deputy to be like Maya" - but that continues dependence on individuals. Others might suggest "changing the context" or "developing capabilities" - but the capabilities existed; they just weren\'t institutionalized.',
                implementationNotes: 'Requires systematic effort to extract tacit knowledge and embed it in structures. Interview Maya extensively before she leaves. Use her final months to document everything and train successors. Build redundancy - multiple people should understand each system.'
            },
            case4: {
                interventionLevel: 'metaconstructor',
                recommendedPatterns: ['review', 'sunset', 'challenge', 'feedback'],
                beautyRanges: {
                    legibility: [70, 80],
                    capacityRevealing: [75, 90],
                    authenticity: [80, 90],
                    implementability: [40, 60]
                },
                expertDescription: 'Establish annual policy review process with evidence evaluation requirement. Include sunset clauses (5-year maximum without review) in all discipline policies. Create safe anonymous reporting system for policy harm concerns. Form diverse stakeholder review committee including students, teachers, parents, disability advocates. Grant schools waiver authority for pilot programs with outcome tracking. Build adaptive learning into system - policies must evolve based on evidence.',
                reasoning: 'This is meta-constructor absence. The system cannot learn from its mistakes or adapt to new information. No review mechanisms, no challenge channels, no revision authority. Even though everyone knows the policy causes harm, there\'s no way to fix it. The solution isn\'t changing THIS policy - it\'s building the capacity to change policies when they fail.',
                commonMistake: 'Students often focus on fixing the content of the specific policy. But the deeper problem is structural - the absence of mechanisms to identify and correct any harmful policy. We need to build the meta-capacity for system improvement.',
                implementationNotes: 'This is politically difficult because it requires legislators to give up control. Frame it as "evidence-based governance" and "protecting children from unintended consequences." Build in safeguards so review process can\'t be captured by any faction. Start with least controversial policies to build trust.'
            },
            case5: {
                interventionLevel: 'multi',
                recommendedPatterns: ['workload', 'support', 'training', 'rituals', 'review'],
                beautyRanges: {
                    legibility: [70, 80],
                    capacityRevealing: [70, 85],
                    authenticity: [75, 90],
                    implementability: [60, 75]
                },
                expertDescription: 'PHASE 1 (Immediate - Context): Emergency stress reduction - cap credit loads at 15, connect students with financial aid resources, offer grade forgiveness for this semester, cancel lowest-stakes assignments. PHASE 2 (Short-term - Capability): Mandatory study skills workshops built into courses, time management coaching, tutoring programs, peer study groups with trained facilitators. PHASE 3 (Medium-term - Constructor): Honor system rebuild through community process, visible consequences for violations with restorative justice approach, academic integrity as cultural value not just rule. PHASE 4 (Long-term - Meta-Constructor): Regular ethics climate surveys, student input on policy effectiveness, review of underlying pressure sources (credit requirements, workload expectations).',
                reasoning: 'This requires integrated multi-level intervention because there are problems at every level. PRIMARY: Capacity suppression (stress, desperation, sleep deprivation). SECONDARY: Capability gaps (poor study skills). TERTIARY: Constructor failure (cheating culture normalized). Must address all levels, but sequence matters - start with capacity (reduce desperation) while building capabilities and changing culture.',
                commonMistake: 'Students often pick just one level. Some say "it\'s the culture" and jump to constructor interventions, missing that stressed, under-skilled students will cheat regardless of culture. Others focus only on capacity ("reduce stress") without addressing skill gaps or culture shifts needed for sustainable change.',
                implementationNotes: 'This is complex and resource-intensive. Requires coordination across multiple departments and buy-in from administration. Phased approach is essential - can\'t do everything at once. Start with emergency capacity interventions to stop the bleeding, then systematically build capabilities and culture.'
            }
        };

        // Design Cases Data
        const DESIGN_CASES = [
            {
                id: 'case1',
                title: 'The Burned-Out Nurses',
                difficulty: 1,
                domain: 'Healthcare',
                diagnosis: {
                    primary: 'Capacity Suppression (85/100)',
                    summary: 'Previously compassionate nurses showing emotional detachment due to chronic understaffing, impossible workloads, and moral injury. Not a capability problem - they know how to be compassionate and show it in other contexts.'
                },
                scenario: `St. Mary's Hospital nurses were once known for compassionate care but are now showing emotional detachment. Investigation reveals:
                
â€¢ Nurses entered healthcare because of genuine compassion
â€¢ They volunteer in communities and show empathy with their own families
â€¢ Hospital has been chronically understaffed due to budget cuts
â€¢ Nurses work 12-14 hour shifts with minimal breaks
â€¢ Each nurse cares for 8-10 patients (best practice: 4-5)
â€¢ No time for proper patient care - must rush through basic needs
â€¢ Moral injury is common: knowing what patients need but unable to provide it
â€¢ Staff meetings cancelled, no processing time for trauma`,
                stakeholders: 'Nurses (burned out), Patients (receiving substandard care), Hospital administrators (budget constraints), Families (concerned)',
                question: 'Design an intervention to restore compassionate nursing care. Remember: this is a CAPACITY problem, not a capability problem.'
            },
            {
                id: 'case2',
                title: 'The Ethics Training Failure',
                difficulty: 1,
                domain: 'Business',
                diagnosis: {
                    primary: 'Capability Gap (80/100)',
                    summary: 'Employees want to be ethical but lack clear protocols and reliable methods. Ethics training provided principles but not specifications for action. Not a capacity or motivation problem.'
                },
                scenario: `TechCorp addressed favoritism, inconsistent standards, and unaddressed harassment with ethics training. Three months later, nothing has changed. Investigation reveals:

â€¢ Expensive ethics training covered principles and values
â€¢ Exit surveys: people found it "inspiring" and want to "do better"
â€¢ But employees say: "I want to be fair, but HOW do I choose between qualified candidates?"
â€¢ "I know harassment is wrong, but what SPECIFICALLY do I say when I witness it?"
â€¢ "The values are great but there's no clear process for applying them"
â€¢ Policies say things like "be ethical" and "treat people fairly" with no specifics
â€¢ No standardized interview process, no clear harassment response protocol
â€¢ No consistent performance evaluation criteria
â€¢ Managers told to "use their judgment" with no training in HOW`,
                stakeholders: 'Employees (want to do right but unsure how), Managers (lack clear protocols), Ethics consultants (taught principles, not practices)',
                question: 'Design an intervention to translate ethical intentions into consistent ethical behavior. Remember: this is a CAPABILITY problem, not a capacity or culture problem.'
            },
            {
                id: 'case3',
                title: 'When the Founder Leaves',
                difficulty: 1,
                domain: 'Organizational',
                diagnosis: {
                    primary: 'Constructor Failure (85/100)',
                    summary: 'Ethical practices worked but depended entirely on founder. Not institutionalized in structures, rituals, or norms. Knowledge left when she left.'
                },
                scenario: `GreenFuture was founded by Maya Chen, deeply committed to environmental and social ethics. Under her leadership, the company had an outstanding reputation. But within six months of her retirement, things fell apart:

â€¢ Maya was the person everyone went to with ethical questions
â€¢ She personally modeled ethical decision-making and told illustrative stories
â€¢ She made final calls on difficult trade-offs
â€¢ Regular ethics meetings (organized by Maya) helped navigate dilemmas
â€¢ Under her leadership: they turned down lucrative contracts if clients wouldn't commit to genuine sustainability
â€¢ After she left: Deputy lacks her moral clarity, ethics meetings stopped, people take contracts they wouldn't have before
â€¢ Several top performers left saying "it's not the same company"
â€¢ All ethical practices lived in Maya's head - nothing documented, no procedures, no training program, no frameworks written down`,
                stakeholders: 'Maya (retired founder), Deputy (can\'t replicate Maya), Employees (lost without founder), Clients (noticing changes)',
                question: 'Design an intervention to make ethical practices persist beyond individual leaders. Remember: this is a CONSTRUCTOR problem - practices exist but aren\'t institutionalized.'
            },
            {
                id: 'case4',
                title: 'The Unchangeable Policy',
                difficulty: 2,
                domain: 'Policy',
                diagnosis: {
                    primary: 'Meta-Constructor Absence (85/100)',
                    summary: 'System cannot examine or improve itself. No review mechanisms, no revision authority, no learning from mistakes. Policy is locked in despite clear evidence of harm.'
                },
                scenario: `Department of Education's 15-year-old "zero tolerance" discipline policy causes clear harm but cannot be changed:

â€¢ Any physical altercation = automatic 10-day suspension, no exceptions
â€¢ Students defending themselves from bullies suspended equally with aggressors
â€¢ Students with disabilities who have behavior episodes suspended at high rates
â€¢ Victims of assault who push attacker away punished same as attacker
â€¢ Research shows suspensions don't improve safety and harm academic outcomes
â€¢ Teachers, principals, school board all acknowledge policy causes harm
â€¢ Everyone agrees it should be revised to allow for context, self-defense, disability accommodations
â€¢ But: Policy is state law, requires legislature to change
â€¢ No legislator wants to be seen as "soft on discipline"
â€¢ No built-in review process, no sunset clause, no exemption process
â€¢ Department has no authority to revise even when presented with evidence of harm`,
                stakeholders: 'Students (being harmed), Teachers/Principals (hands tied), School board (no authority), Legislators (politically difficult), Parents (frustrated)',
                question: 'Design an intervention to enable the system to learn from mistakes and adapt. Remember: this is a META-CONSTRUCTOR problem - the system lacks the capacity to improve itself.'
            },
            {
                id: 'case5',
                title: 'The Cheating Epidemic',
                difficulty: 3,
                domain: 'Education',
                diagnosis: {
                    primary: 'Multi-Level Problem',
                    summary: 'Capacity suppression (stress, desperation, sleep deprivation) + Capability gaps (poor study skills) + Constructor failure (cheating culture normalized). Requires integrated intervention across all levels.'
                },
                scenario: `Riverside University discovered 40% of engineering students cheating on recent exam. Investigation reveals multiple factors:

CAPACITY LEVEL:
â€¢ Students taking 18+ credits while working 20+ hours/week to afford tuition
â€¢ Sleeping 4-5 hours/night, report feeling desperate and unable to keep up
â€¢ Many say they feel they have no choice - it's cheat or fail

CAPABILITY LEVEL:
â€¢ Many students never learned effective study skills in high school
â€¢ They're trying but don't know HOW to learn the material in time available
â€¢ High school didn't prepare them for university-level work

CONSTRUCTOR LEVEL:
â€¢ Culture of cheating has developed - "everyone does it"
â€¢ Sharing test banks is normalized
â€¢ Students who don't cheat feel like "suckers"
â€¢ Honor code introduced 10 years ago, violations were rare, now endemic

CONTEXT CHANGES:
â€¢ Tuition increases forcing students to work more
â€¢ Class sizes tripled while instructors decreased
â€¢ Support services cut
â€¢ Students feel anonymous, no relationship with professors`,
                stakeholders: 'Students (stressed, desperate, some lacking skills), Faculty (overwhelmed, disappointed), Administration (budget pressures), Parents (concerned)',
                question: 'Design an integrated multi-level intervention. This requires addressing capacity suppression, capability gaps, AND cultural reconstruction. Consider sequencing and resource allocation.'
            }
        ];

        // Pattern Recognition Questions
        const PATTERN_QUESTIONS = [
            {
                id: 'pr1',
                scenario: 'A factory has safety procedures that work perfectly when the safety officer is present, but workers skip steps when she\'s away. Procedures aren\'t written down or formally trained.',
                correctLevel: 'constructor',
                correctPatterns: ['documentation', 'training', 'rituals'],
                explanation: 'Constructor failure - practices depend on individual presence. Need to institutionalize through documentation, formal training, and building safety checks into normal workflow rituals.'
            },
            {
                id: 'pr2',
                scenario: 'Social workers want to help clients but burn out quickly from constant exposure to trauma with no support systems or time for self-care.',
                correctLevel: 'context',
                correctPatterns: ['support', 'workload', 'autonomy'],
                explanation: 'Capacity suppression - chronic stress and lack of support. Need context redesign: manageable caseloads, peer support groups, mandatory self-care time, trauma processing resources.'
            },
            {
                id: 'pr3',
                scenario: 'Hospital has excellent patient safety protocols, but there\'s no system to update them when new evidence emerges. Last revision was 10 years ago despite multiple relevant studies.',
                correctLevel: 'metaconstructor',
                correctPatterns: ['review', 'feedback'],
                explanation: 'Meta-constructor absence - system can\'t learn or adapt. Need review mechanisms: regular evidence review process, stakeholder feedback systems, update protocols with sunset clauses.'
            },
            {
                id: 'pr4',
                scenario: 'Teachers want to implement inclusive education but don\'t know specific techniques for adapting lessons to different learning styles and needs.',
                correctLevel: 'capability',
                correctPatterns: ['training', 'specifications', 'protocols'],
                explanation: 'Capability gap - good intentions but lack reliable methods. Need capability development: clear instructional protocols, training in specific techniques, practice with feedback, peer consultation systems.'
            },
            {
                id: 'pr5',
                scenario: 'A nonprofit\'s conflict resolution process works great, but only because the founder mediates. When anyone else tries, conflicts escalate. No one else knows her methods.',
                correctLevel: 'constructor',
                correctPatterns: ['documentation', 'training', 'succession'],
                explanation: 'Constructor failure - depends on individual. Need institutionalization: document the process, train multiple mediators, create standard protocols that work without the founder.'
            },
            {
                id: 'pr6',
                scenario: 'City council makes decisions behind closed doors with no public input process or requirement to consider stakeholder concerns. Many policies serve narrow interests.',
                correctLevel: 'metaconstructor',
                correctPatterns: ['feedback', 'challenge', 'review'],
                explanation: 'Meta-constructor absence - no accountability or learning mechanisms. Need: public input requirements, transparent decision-making, stakeholder consultation process, policy review with community feedback.'
            },
            {
                id: 'pr7',
                scenario: 'Employees want to be environmentally responsible but don\'t know what actions actually make a difference. Sustainability guidelines are vague ("reduce waste").',
                correctLevel: 'capability',
                correctPatterns: ['specifications', 'training', 'protocols'],
                explanation: 'Capability gap - motivation exists but methods unclear. Need clear specifications: specific actions with measurable impact, training in implementation, clear protocols for each role.'
            },
            {
                id: 'pr8',
                scenario: 'Police officers experiencing high rates of PTSD from repeated trauma exposure. No mandatory counseling, no peer support, heavy caseloads, long shifts.',
                correctLevel: 'context',
                correctPatterns: ['support', 'workload', 'autonomy'],
                explanation: 'Capacity suppression from chronic trauma without recovery. Need context redesign: mandatory counseling access, peer support programs, manageable shift schedules, trauma recovery time.'
            },
            {
                id: 'pr9',
                scenario: 'University tenure review process is opaque and inconsistent. No clear criteria, no feedback mechanisms, no appeal process. Decisions seem arbitrary and can\'t be questioned.',
                correctLevel: 'metaconstructor',
                correctPatterns: ['review', 'challenge', 'feedback'],
                explanation: 'Meta-constructor absence - no transparency or improvement mechanisms. Need: clear published criteria, feedback systems, appeal process, regular policy review with faculty input.'
            },
            {
                id: 'pr10',
                scenario: 'Restaurant successfully implemented farm-to-table sourcing under previous owner. New owner wants to continue but doesn\'t know the supplier relationships, ordering schedules, or seasonal planning systems.',
                correctLevel: 'constructor',
                correctPatterns: ['documentation', 'training', 'succession'],
                explanation: 'Constructor failure - knowledge not institutionalized. Need to rebuild: document supplier relationships, create ordering protocols, train staff in seasonal planning, build systems that persist across ownership.'
            }
        ];

        // Design Patterns Library
        const DESIGN_PATTERNS = {
            context: {
                name: 'Context Redesign',
                description: 'Interventions that change environmental conditions to liberate suppressed capacity',
                patterns: [
                    {
                        id: 'workload',
                        name: 'Workload Reduction',
                        description: 'Reduce excessive demands to sustainable levels',
                        examples: ['Hire additional staff', 'Eliminate non-essential tasks', 'Set workload caps', 'Redistribute responsibilities']
                    },
                    {
                        id: 'autonomy',
                        name: 'Autonomy Restoration',
                        description: 'Give people control over how they accomplish work',
                        examples: ['Flexible scheduling', 'Method choice', 'Decision authority', 'Remove micromanagement']
                    },
                    {
                        id: 'support',
                        name: 'Social Support Structures',
                        description: 'Build networks for mutual support and recovery',
                        examples: ['Peer support groups', 'Mentoring programs', 'Team building', 'Counseling access']
                    },
                    {
                        id: 'stress',
                        name: 'Stress Buffer Systems',
                        description: 'Create buffers between stressors and people',
                        examples: ['Break protocols', 'Recovery time', 'Quiet spaces', 'Stress leave policies']
                    }
                ]
            },
            capability: {
                name: 'Capability Development',
                description: 'Interventions that build reliable methods for ethical coordination',
                patterns: [
                    {
                        id: 'specifications',
                        name: 'Clear Specifications',
                        description: 'Define exactly what good performance looks like',
                        examples: ['Decision criteria', 'Step-by-step protocols', 'Evaluation rubrics', 'Standards documentation']
                    },
                    {
                        id: 'training',
                        name: 'Skills Training',
                        description: 'Develop capabilities through practice and feedback',
                        examples: ['Workshop programs', 'Role-play scenarios', 'Mentored practice', 'Skill certification']
                    },
                    {
                        id: 'protocols',
                        name: 'Standard Protocols',
                        description: 'Create reliable procedures that work under pressure',
                        examples: ['Checklists', 'Decision trees', 'Response scripts', 'Emergency procedures']
                    },
                    {
                        id: 'support',
                        name: 'Performance Support Systems',
                        description: 'Provide just-in-time help for complex situations',
                        examples: ['Help lines', 'Peer consultation', 'Expert referral', 'Decision support tools']
                    }
                ]
            },
            constructor: {
                name: 'Institutionalization',
                description: 'Interventions that make patterns persist independent of individuals',
                patterns: [
                    {
                        id: 'documentation',
                        name: 'Knowledge Documentation',
                        description: 'Capture tacit knowledge in explicit form',
                        examples: ['Process manuals', 'Decision frameworks', 'Case libraries', 'Best practice guides']
                    },
                    {
                        id: 'training',
                        name: 'Training Systems',
                        description: 'Systematically transfer knowledge to new people',
                        examples: ['Onboarding programs', 'Mentoring protocols', 'Certification processes', 'Cross-training']
                    },
                    {
                        id: 'rituals',
                        name: 'Organizational Rituals',
                        description: 'Build practices into regular organizational rhythms',
                        examples: ['Standard meetings', 'Review ceremonies', 'Celebration events', 'Reflection practices']
                    },
                    {
                        id: 'succession',
                        name: 'Succession Planning',
                        description: 'Prepare for leadership transitions',
                        examples: ['Shadowing programs', 'Gradual handoffs', 'Redundant expertise', 'Distributed leadership']
                    }
                ]
            },
            metaconstructor: {
                name: 'Learning Systems',
                description: 'Interventions that enable systems to examine and improve themselves',
                patterns: [
                    {
                        id: 'review',
                        name: 'Review Mechanisms',
                        description: 'Regular processes for evaluating effectiveness',
                        examples: ['Annual policy review', 'Outcome audits', 'Impact assessment', 'Evidence evaluation']
                    },
                    {
                        id: 'sunset',
                        name: 'Sunset Clauses',
                        description: 'Automatic expiration forcing re-evaluation',
                        examples: ['Time-limited policies', 'Required renewal', 'Pilot programs', 'Experimental periods']
                    },
                    {
                        id: 'challenge',
                        name: 'Challenge Channels',
                        description: 'Safe ways to question existing practices',
                        examples: ['Anonymous feedback', 'Ombudsman systems', 'Whistleblower protection', 'Public comment periods']
                    },
                    {
                        id: 'feedback',
                        name: 'Feedback Systems',
                        description: 'Mechanisms to gather and respond to stakeholder input',
                        examples: ['Surveys', 'Focus groups', 'Suggestion systems', 'Stakeholder councils']
                    }
                ]
            }
        };

        // Main App Component
        function App() {
            const [stage, setStage] = useState('welcome');
            const [studentInfo, setStudentInfo] = useState({
                name: '',
                email: '',
                course: ''
            });
            const [sessionData, setSessionData] = useState({
                sessionId: '',
                startTime: null,
                completionTime: null,
                designs: [],
                patternRecognition: {
                    answers: [],
                    score: 0
                }
            });
            const [currentCaseIndex, setCurrentCaseIndex] = useState(0);

            // Load saved progress
            useEffect(() => {
                const saved = localStorage.getItem('module3Progress');
                if (saved) {
                    const data = JSON.parse(saved);
                    if (data.sessionData) setSessionData(data.sessionData);
                    if (data.studentInfo) setStudentInfo(data.studentInfo);
                    if (data.stage) setStage(data.stage);
                    if (data.currentCaseIndex !== undefined) setCurrentCaseIndex(data.currentCaseIndex);
                }
            }, []);

            // Save progress
            useEffect(() => {
                localStorage.setItem('module3Progress', JSON.stringify({
                    sessionData,
                    studentInfo,
                    stage,
                    currentCaseIndex
                }));
            }, [sessionData, studentInfo, stage, currentCaseIndex]);

            const startModule = (info) => {
                const sessionId = generateSessionId();
                const startTime = new Date().toISOString();
                setStudentInfo(info);
                setSessionData({
                    sessionId,
                    startTime,
                    completionTime: null,
                    designs: [],
                    patternRecognition: { answers: [], score: 0 }
                });
                setStage('tutorial');
            };

            const startDesignWork = () => {
                setStage('patterns');
            };

            const startCases = () => {
                setStage('cases');
                setCurrentCaseIndex(0);
            };

            const completeCaseDesign = (designData) => {
                const updatedDesigns = [...sessionData.designs, designData];
                setSessionData({
                    ...sessionData,
                    designs: updatedDesigns
                });

                if (currentCaseIndex < DESIGN_CASES.length - 1) {
                    setCurrentCaseIndex(currentCaseIndex + 1);
                } else {
                    setStage('pattern');
                }
            };

            const completePatternRecognition = (results) => {
                setSessionData({
                    ...sessionData,
                    patternRecognition: results,
                    completionTime: new Date().toISOString()
                });
                setStage('complete');
            };

            return (
                <div className="min-h-screen">
                    <header className="gradient-bg text-white shadow-lg">
                        <div className="max-w-5xl mx-auto px-4 py-6">
                            <div className="flex justify-between items-start">
                                <div>
                                    <h1 className="text-3xl font-bold mb-2">Module 3: Design Studio</h1>
                                    <p className="text-lg opacity-90">Learn to design interventions at the right level</p>
                                </div>
                                {stage !== 'welcome' && (
                                    <button
                                        onClick={() => {
                                            if (window.confirm('âš ï¸ This will permanently delete ALL your saved progress and start over from the beginning.\n\nAre you sure you want to reset?')) {
                                                localStorage.clear();
                                                window.location.reload();
                                            }
                                        }}
                                        className="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg font-semibold transition-colors flex items-center space-x-2 whitespace-nowrap text-sm"
                                        title="Clear all progress and start over"
                                    >
                                        <span>ðŸ”„</span>
                                        <span>Start Over</span>
                                    </button>
                                )}
                            </div>
                        </div>
                    </header>

                    <main className="max-w-5xl mx-auto px-4 py-8">
                        {stage === 'welcome' && (
                            <WelcomeScreen onStart={startModule} />
                        )}
                        {stage === 'tutorial' && (
                            <TutorialScreen onComplete={() => setStage('patterns')} />
                        )}
                        {stage === 'patterns' && (
                            <PatternLibraryScreen onComplete={startCases} />
                        )}
                        {stage === 'cases' && (
                            <DesignWorkflow 
                                key={currentCaseIndex}
                                caseData={DESIGN_CASES[currentCaseIndex]}
                                caseNumber={currentCaseIndex + 1}
                                totalCases={DESIGN_CASES.length}
                                onComplete={completeCaseDesign}
                            />
                        )}
                        {stage === 'pattern' && (
                            <PatternRecognitionGame 
                                questions={PATTERN_QUESTIONS}
                                onComplete={completePatternRecognition}
                            />
                        )}
                        {stage === 'complete' && (
                            <CompletionScreen 
                                studentInfo={studentInfo}
                                sessionData={sessionData}
                            />
                        )}
                    </main>
                </div>
            );
        }

        // Welcome Screen Component
        function WelcomeScreen({ onStart }) {
            const [formData, setFormData] = useState({
                name: '',
                email: '',
                course: ''
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                if (formData.name && formData.email && formData.course) {
                    onStart(formData);
                }
            };

            return (
                <div className="fade-in max-w-2xl mx-auto">
                    <div className="bg-white rounded-lg shadow-lg p-8 mb-6">
                        <h2 className="text-3xl font-bold text-gray-900 mb-4">Welcome to the Design Studio</h2>
                        <div className="prose prose-lg">
                            <p className="text-gray-700 mb-4">
                                You've learned to <strong>diagnose</strong> ethical problems in Module 2. Now you'll learn to 
                                <strong> design interventions</strong> that work at the right level.
                            </p>
                            <ul className="space-y-2 text-gray-700 mb-6">
                                <li><strong>Context Redesign:</strong> Change environments to liberate suppressed capacity</li>
                                <li><strong>Capability Development:</strong> Build reliable methods for ethical coordination</li>
                                <li><strong>Institutionalization:</strong> Make patterns persist beyond individuals</li>
                                <li><strong>Learning Systems:</strong> Enable systems to examine and improve themselves</li>
                            </ul>
                            
                            <div className="bg-purple-50 border-l-4 border-purple-500 p-6 mt-6">
                                <h3 className="text-lg font-bold text-purple-900 mb-2">Why Design Matters</h3>
                                <p className="text-gray-700 text-base">
                                    Diagnosis identifies the problem level. <strong>Design determines what actually changes.</strong> A 
                                    perfect diagnosis is worthless without effective intervention. Wrong-level interventions waste resources 
                                    and can make things worse - training people who need better contexts, changing contexts when people need 
                                    training. You'll learn to design interventions that match the problem level and create lasting change.
                                </p>
                            </div>
                        </div>
                    </div>

                    <div className="bg-white rounded-lg shadow-lg p-8 mb-6">
                        <h3 className="text-2xl font-bold text-gray-900 mb-4">What You'll Do</h3>
                        <div className="space-y-3">
                            <div className="flex items-start">
                                <span className="text-2xl mr-3">ðŸ“š</span>
                                <div>
                                    <p className="font-semibold text-gray-900">Tutorial (10 minutes)</p>
                                    <p className="text-sm text-gray-600">Learn the four intervention levels and when to use each</p>
                                </div>
                            </div>
                            <div className="flex items-start">
                                <span className="text-2xl mr-3">ðŸŽ¨</span>
                                <div>
                                    <p className="font-semibold text-gray-900">Design Pattern Library (5 minutes)</p>
                                    <p className="text-sm text-gray-600">Reference guide to proven intervention patterns</p>
                                </div>
                            </div>
                            <div className="flex items-start">
                                <span className="text-2xl mr-3">ðŸ”§</span>
                                <div>
                                    <p className="font-semibold text-gray-900">5 Design Exercises (60-80 minutes)</p>
                                    <p className="text-sm text-gray-600">Design interventions for pre-diagnosed cases with expert feedback</p>
                                </div>
                            </div>
                            <div className="flex items-start">
                                <span className="text-2xl mr-3">âš¡</span>
                                <div>
                                    <p className="font-semibold text-gray-900">Pattern Recognition (10 minutes)</p>
                                    <p className="text-sm text-gray-600">Quick-fire practice matching interventions to problems</p>
                                </div>
                            </div>
                            <div className="flex items-start">
                                <span className="text-2xl mr-3">ðŸ“„</span>
                                <div>
                                    <p className="font-semibold text-gray-900">Completion Document</p>
                                    <p className="text-sm text-gray-600">Auto-graded results with 75% threshold for passing</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="bg-white rounded-lg shadow-lg p-8">
                        <h3 className="text-2xl font-bold text-gray-900 mb-4">Before You Begin</h3>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Full Name *
                                </label>
                                <input
                                    type="text"
                                    required
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                    value={formData.name}
                                    onChange={(e) => setFormData({...formData, name: e.target.value})}
                                    placeholder="Enter your full name"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Email Address *
                                </label>
                                <input
                                    type="email"
                                    required
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                    value={formData.email}
                                    onChange={(e) => setFormData({...formData, email: e.target.value})}
                                    placeholder="your.email@university.edu"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Course/Section *
                                </label>
                                <input
                                    type="text"
                                    required
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                    value={formData.course}
                                    onChange={(e) => setFormData({...formData, course: e.target.value})}
                                    placeholder="e.g., PHIL 101 - Section 02"
                                />
                            </div>
                            <button
                                type="submit"
                                className="w-full bg-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-purple-700 transition-colors"
                            >
                                Begin Module 3 â†’
                            </button>
                        </form>
                    </div>
                </div>
            );
        }

        // Tutorial Screen Component
        function TutorialScreen({ onComplete }) {
            return (
                <div className="fade-in max-w-3xl mx-auto">
                    <div className="bg-white rounded-lg shadow-lg p-8 mb-6">
                        <h2 className="text-3xl font-bold text-gray-900 mb-6">The Four Intervention Levels</h2>
                        
                        <div className="space-y-6">
                            <div className="border-l-4 border-blue-500 pl-6 py-4 bg-blue-50">
                                <h3 className="text-xl font-bold text-blue-900 mb-2">Level 1: Context Redesign</h3>
                                <p className="text-gray-700 mb-2">
                                    <strong>Purpose:</strong> Change environmental conditions to liberate suppressed capacity
                                </p>
                                <p className="text-gray-600 text-sm mb-2">
                                    <strong>When to use:</strong> Capacity suppression problems - people have the capacity but context prevents its expression
                                </p>
                                <p className="text-gray-600 text-sm mb-2">
                                    <strong>Key principle:</strong> "Change the context, not the person" (Sapolsky)
                                </p>
                                <p className="text-gray-600 text-sm">
                                    <strong>Examples:</strong> Reduce workloads to sustainable levels, restore autonomy and control, 
                                    build social support systems, create stress buffers
                                </p>
                            </div>

                            <div className="border-l-4 border-green-500 pl-6 py-4 bg-green-50">
                                <h3 className="text-xl font-bold text-green-900 mb-2">Level 2: Capability Development</h3>
                                <p className="text-gray-700 mb-2">
                                    <strong>Purpose:</strong> Build reliable methods for ethical coordination
                                </p>
                                <p className="text-gray-600 text-sm mb-2">
                                    <strong>When to use:</strong> Capability gap problems - people want to do right but lack clear methods
                                </p>
                                <p className="text-gray-600 text-sm mb-2">
                                    <strong>Key principle:</strong> "Make it possible to do right reliably"
                                </p>
                                <p className="text-gray-600 text-sm">
                                    <strong>Examples:</strong> Create clear specifications and protocols, develop training programs with practice, 
                                    build decision support systems, establish peer consultation
                                </p>
                            </div>

                            <div className="border-l-4 border-purple-500 pl-6 py-4 bg-purple-50">
                                <h3 className="text-xl font-bold text-purple-900 mb-2">Level 3: Institutionalization</h3>
                                <p className="text-gray-700 mb-2">
                                    <strong>Purpose:</strong> Make patterns persist independent of individuals
                                </p>
                                <p className="text-gray-600 text-sm mb-2">
                                    <strong>When to use:</strong> Constructor failure problems - practices work but depend on specific people
                                </p>
                                <p className="text-gray-600 text-sm mb-2">
                                    <strong>Key principle:</strong> "Make it persist without heroes"
                                </p>
                                <p className="text-gray-600 text-sm">
                                    <strong>Examples:</strong> Document tacit knowledge, create formal training systems, 
                                    build organizational rituals, develop succession planning
                                </p>
                            </div>

                            <div className="border-l-4 border-red-500 pl-6 py-4 bg-red-50">
                                <h3 className="text-xl font-bold text-red-900 mb-2">Level 4: Learning Systems (Meta-Constructor)</h3>
                                <p className="text-gray-700 mb-2">
                                    <strong>Purpose:</strong> Enable systems to examine and improve themselves
                                </p>
                                <p className="text-gray-600 text-sm mb-2">
                                    <strong>When to use:</strong> Meta-constructor absence - system can't learn from mistakes or adapt
                                </p>
                                <p className="text-gray-600 text-sm mb-2">
                                    <strong>Key principle:</strong> "Build in the ability to improve itself"
                                </p>
                                <p className="text-gray-600 text-sm">
                                    <strong>Examples:</strong> Establish review mechanisms, include sunset clauses, 
                                    create safe challenge channels, build feedback systems
                                </p>
                            </div>
                        </div>
                    </div>

                    <div className="bg-gradient-to-br from-purple-100 to-purple-50 rounded-lg p-8 mb-6">
                        <h3 className="text-2xl font-bold text-purple-900 mb-4">Matching Interventions to Problems</h3>
                        <div className="space-y-3 text-gray-700">
                            <p className="font-semibold">The most common design mistake: intervening at the wrong level.</p>
                            <div className="bg-white p-4 rounded-lg">
                                <p className="font-semibold text-red-700 mb-2">âŒ Wrong-Level Interventions:</p>
                                <ul className="space-y-1 text-sm">
                                    <li>â€¢ Training burned-out people who need better working conditions (capability for capacity)</li>
                                    <li>â€¢ Reducing workload when people need clear protocols (context for capability)</li>
                                    <li>â€¢ Documenting practices that don't exist yet (constructor for capability)</li>
                                    <li>â€¢ Creating review processes for systems that can't implement changes (meta-constructor for capacity)</li>
                                </ul>
                            </div>
                            <div className="bg-white p-4 rounded-lg">
                                <p className="font-semibold text-green-700 mb-2">âœ“ Right-Level Interventions:</p>
                                <ul className="space-y-1 text-sm">
                                    <li>â€¢ Match the intervention level to the diagnosed problem level</li>
                                    <li>â€¢ For multi-level problems, sequence interventions appropriately</li>
                                    <li>â€¢ Address capacity suppression before building capabilities</li>
                                    <li>â€¢ Develop capabilities before institutionalizing them</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div className="bg-white rounded-lg shadow-lg p-8 mb-6">
                        <h3 className="text-2xl font-bold text-gray-900 mb-4">Beautiful Design Criteria</h3>
                        <p className="text-gray-700 mb-4">
                            Good interventions aren't just effective - they're <strong>beautiful</strong>. They create 
                            "future pull" that makes people want the change. Evaluate designs on four dimensions:
                        </p>
                        <div className="space-y-3">
                            <div className="border-l-4 border-purple-500 pl-4 py-2">
                                <p className="font-semibold text-gray-900">Legibility</p>
                                <p className="text-sm text-gray-600">How clear and understandable is the intervention? Can people grasp it quickly?</p>
                            </div>
                            <div className="border-l-4 border-purple-500 pl-4 py-2">
                                <p className="font-semibold text-gray-900">Capacity-Revealing</p>
                                <p className="text-sm text-gray-600">Does it show people new possibilities? Reveal capabilities they didn't know they had?</p>
                            </div>
                            <div className="border-l-4 border-purple-500 pl-4 py-2">
                                <p className="font-semibold text-gray-900">Authenticity</p>
                                <p className="text-sm text-gray-600">Will people recognize themselves in this better future? Feel it's genuinely theirs?</p>
                            </div>
                            <div className="border-l-4 border-purple-500 pl-4 py-2">
                                <p className="font-semibold text-gray-900">Implementability</p>
                                <p className="text-sm text-gray-600">Can this actually be done with available resources, authority, and timeframe?</p>
                            </div>
                        </div>
                    </div>

                    <div className="bg-white rounded-lg shadow-lg p-8">
                        <button
                            onClick={onComplete}
                            className="w-full bg-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-purple-700 transition-colors"
                        >
                            Continue to Design Patterns â†’
                        </button>
                    </div>
                </div>
            );
        }

        // Pattern Library Screen Component
        function PatternLibraryScreen({ onComplete }) {
            const [selectedLevel, setSelectedLevel] = useState('context');

            return (
                <div className="fade-in max-w-4xl mx-auto">
                    <div className="bg-white rounded-lg shadow-lg p-8 mb-6">
                        <h2 className="text-3xl font-bold text-gray-900 mb-4">Design Pattern Library</h2>
                        <p className="text-gray-700 mb-6">
                            These are proven intervention patterns you can adapt to specific situations. 
                            You'll reference this library during design exercises.
                        </p>

                        <div className="flex space-x-2 mb-6 overflow-x-auto">
                            {Object.keys(DESIGN_PATTERNS).map(level => (
                                <button
                                    key={level}
                                    onClick={() => setSelectedLevel(level)}
                                    className={`px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition-colors ${
                                        selectedLevel === level
                                            ? 'bg-purple-600 text-white'
                                            : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                    }`}
                                >
                                    {DESIGN_PATTERNS[level].name}
                                </button>
                            ))}
                        </div>

                        <div className="bg-purple-50 p-6 rounded-lg mb-6">
                            <h3 className="text-xl font-bold text-purple-900 mb-2">
                                {DESIGN_PATTERNS[selectedLevel].name}
                            </h3>
                            <p className="text-gray-700">
                                {DESIGN_PATTERNS[selectedLevel].description}
                            </p>
                        </div>

                        <div className="space-y-4">
                            {DESIGN_PATTERNS[selectedLevel].patterns.map(pattern => (
                                <div key={pattern.id} className="border border-gray-200 rounded-lg p-4">
                                    <h4 className="font-bold text-gray-900 mb-2">{pattern.name}</h4>
                                    <p className="text-gray-700 text-sm mb-3">{pattern.description}</p>
                                    <div className="bg-gray-50 p-3 rounded">
                                        <p className="text-xs font-semibold text-gray-600 mb-2">Examples:</p>
                                        <ul className="text-sm text-gray-700 space-y-1">
                                            {pattern.examples.map((example, idx) => (
                                                <li key={idx}>â€¢ {example}</li>
                                            ))}
                                        </ul>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="bg-gradient-to-br from-blue-100 to-blue-50 rounded-lg p-6 mb-6">
                        <h3 className="text-lg font-bold text-blue-900 mb-2">ðŸ’¡ Using the Pattern Library</h3>
                        <p className="text-gray-700 text-sm">
                            During design exercises, you can reference this library at any time. These patterns are 
                            starting points - adapt them to your specific context. Most real interventions combine 
                            multiple patterns. The art is choosing which patterns fit your diagnosed problem.
                        </p>
                    </div>

                    <div className="bg-white rounded-lg shadow-lg p-8">
                        <h3 className="text-xl font-bold text-gray-900 mb-3">Ready to Design?</h3>
                        <p className="text-gray-700 mb-6">
                            You've learned the intervention levels and seen the pattern library. Now you'll design 
                            interventions for 5 pre-diagnosed cases. For each case, you'll choose the intervention 
                            level, describe your design, select patterns, check for beauty, and assess risks.
                        </p>
                        <button
                            onClick={onComplete}
                            className="w-full bg-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-purple-700 transition-colors"
                        >
                            Start Design Exercises â†’
                        </button>
                    </div>
                </div>
            );
        }

        // Design Workflow Component
        function DesignWorkflow({ caseData, caseNumber, totalCases, onComplete }) {
            const [phase, setPhase] = useState('read');
            const [caseStartTime] = useState(new Date().toISOString());
            const [design, setDesign] = useState({
                interventionLevel: '',
                description: '',
                patterns: [],
                beautyScores: {
                    legibility: 50,
                    capacityRevealing: 50,
                    authenticity: 50,
                    implementability: 50
                },
                risks: [],
                mitigation: ''
            });
            const [score, setScore] = useState(0);

            const handleSubmit = () => {
                const expert = EXPERT_DESIGNS[caseData.id];
                const calculatedScore = calculateDesignScore(design, expert);
                setScore(calculatedScore);
                setPhase('review');
            };

            const handleComplete = () => {
                const caseEndTime = new Date().toISOString();
                const expert = EXPERT_DESIGNS[caseData.id];
                
                const designResult = {
                    caseId: caseData.id,
                    title: caseData.title,
                    startTime: caseStartTime,
                    endTime: caseEndTime,
                    design,
                    expertDesign: expert,
                    score
                };

                onComplete(designResult);
            };

            return (
                <div className="fade-in">
                    <div className="bg-white rounded-lg shadow p-4 mb-6">
                        <div className="flex justify-between items-center mb-2">
                            <span className="text-sm font-medium text-gray-700">
                                Case {caseNumber} of {totalCases}: {caseData.title}
                            </span>
                            <span className="text-sm text-gray-600">{caseData.domain}</span>
                        </div>
                        <div className="w-full bg-gray-200 rounded-full h-2">
                            <div 
                                className="progress-bar bg-purple-600 h-2 rounded-full"
                                style={{width: `${(caseNumber / totalCases) * 100}%`}}
                            ></div>
                        </div>
                    </div>

                    {phase === 'read' && (
                        <ReadPhase caseData={caseData} onNext={() => setPhase('design')} />
                    )}

                    {phase === 'design' && (
                        <DesignPhase 
                            caseData={caseData}
                            design={design}
                            setDesign={setDesign}
                            onSubmit={handleSubmit}
                        />
                    )}

                    {phase === 'review' && (
                        <ReviewPhase 
                            caseData={caseData}
                            design={design}
                            expertDesign={EXPERT_DESIGNS[caseData.id]}
                            score={score}
                            onNext={handleComplete}
                            caseNumber={caseNumber}
                            totalCases={totalCases}
                        />
                    )}
                </div>
            );
        }

        // Read Phase Component
        function ReadPhase({ caseData, onNext }) {
            return (
                <div className="bg-white rounded-lg shadow-lg p-8">
                    <h2 className="text-3xl font-bold text-gray-900 mb-2">{caseData.title}</h2>
                    <div className="flex items-center space-x-4 mb-6">
                        <span className="px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full">
                            {caseData.domain}
                        </span>
                        <span className="px-3 py-1 bg-gray-100 text-gray-800 text-sm rounded-full">
                            Difficulty: {caseData.difficulty}/3
                        </span>
                    </div>

                    <div className="bg-purple-50 border-l-4 border-purple-500 p-6 mb-6">
                        <h3 className="font-semibold text-purple-900 mb-2">Diagnosis Provided</h3>
                        <p className="text-lg font-bold text-gray-900 mb-2">{caseData.diagnosis.primary}</p>
                        <p className="text-gray-700 text-sm">{caseData.diagnosis.summary}</p>
                    </div>

                    <div className="prose prose-lg max-w-none mb-8">
                        <h3 className="text-xl font-semibold text-gray-900 mb-3">The Situation</h3>
                        <div className="text-gray-700 whitespace-pre-line mb-6">
                            {caseData.scenario}
                        </div>

                        <div className="bg-gray-50 p-4 rounded-lg mb-6">
                            <h4 className="font-semibold text-gray-900 mb-2">Stakeholders</h4>
                            <p className="text-sm text-gray-700">{caseData.stakeholders}</p>
                        </div>

                        <div className="bg-blue-50 border-l-4 border-blue-500 p-6">
                            <h4 className="font-semibold text-blue-900 mb-2">Your Design Challenge</h4>
                            <p className="text-gray-700">{caseData.question}</p>
                        </div>
                    </div>

                    <button
                        onClick={onNext}
                        className="w-full bg-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-purple-700 transition-colors"
                    >
                        Start Designing â†’
                    </button>
                </div>
            );
        }

        // Design Phase Component (continues in next part due to length...)
        function DesignPhase({ caseData, design, setDesign, onSubmit }) {
            const [step, setStep] = useState(0);

            const updateDesign = (field, value) => {
                setDesign({
                    ...design,
                    [field]: value
                });
            };

            const updateBeautyScore = (dimension, value) => {
                setDesign({
                    ...design,
                    beautyScores: {
                        ...design.beautyScores,
                        [dimension]: parseInt(value)
                    }
                });
            };

            const togglePattern = (patternId) => {
                const current = design.patterns || [];
                const updated = current.includes(patternId)
                    ? current.filter(p => p !== patternId)
                    : [...current, patternId];
                updateDesign('patterns', updated);
            };

            const toggleRisk = (risk) => {
                const current = design.risks || [];
                const updated = current.includes(risk)
                    ? current.filter(r => r !== risk)
                    : [...current, risk];
                updateDesign('risks', updated);
            };

            const steps = [
                {
                    title: 'Choose Intervention Level',
                    component: (
                        <div>
                            <p className="text-gray-700 mb-4">
                                Based on the diagnosis <strong>"{caseData.diagnosis.primary}"</strong>, 
                                what intervention level should you use?
                            </p>
                            <div className="space-y-3">
                                {[
                                    { value: 'context', label: 'Context Redesign', description: 'Change environment to liberate capacity' },
                                    { value: 'capability', label: 'Capability Development', description: 'Build reliable methods' },
                                    { value: 'constructor', label: 'Institutionalization', description: 'Make patterns persist' },
                                    { value: 'metaconstructor', label: 'Learning Systems', description: 'Enable self-improvement' }
                                ].map(option => (
                                    <label
                                        key={option.value}
                                        className={`flex items-start p-4 border-2 rounded-lg cursor-pointer transition-colors ${
                                            design.interventionLevel === option.value
                                                ? 'border-purple-500 bg-purple-50'
                                                : 'border-gray-200 hover:border-gray-300'
                                        }`}
                                    >
                                        <input
                                            type="radio"
                                            name="level"
                                            value={option.value}
                                            checked={design.interventionLevel === option.value}
                                            onChange={(e) => updateDesign('interventionLevel', e.target.value)}
                                            className="mt-1 mr-3"
                                        />
                                        <div>
                                            <p className="font-semibold text-gray-900">{option.label}</p>
                                            <p className="text-sm text-gray-600">{option.description}</p>
                                        </div>
                                    </label>
                                ))}
                            </div>
                        </div>
                    )
                },
                {
                    title: 'Describe Your Intervention',
                    component: (
                        <div>
                            <p className="text-gray-700 mb-4">
                                Describe your intervention in 2-4 sentences. Be specific about what will change and how.
                            </p>
                            <textarea
                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                rows="6"
                                placeholder="Example: 'Hire 10 additional nurses to reduce patient load from 8-10 patients to 4-5 per nurse (best practice). Institute mandatory 30-minute breaks every 4 hours. Create weekly peer support groups for processing moral injury...'"
                                value={design.description}
                                onChange={(e) => updateDesign('description', e.target.value)}
                            ></textarea>
                        </div>
                    )
                },
                {
                    title: 'Select Design Patterns',
                    component: (
                        <div>
                            <p className="text-gray-700 mb-4">
                                Which design patterns from the library are you using? Select all that apply.
                            </p>
                            {design.interventionLevel && DESIGN_PATTERNS[design.interventionLevel] && (
                                <div className="space-y-3">
                                    {DESIGN_PATTERNS[design.interventionLevel].patterns.map(pattern => (
                                        <label
                                            key={pattern.id}
                                            className="flex items-start p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50"
                                        >
                                            <input
                                                type="checkbox"
                                                checked={design.patterns.includes(pattern.id)}
                                                onChange={() => togglePattern(pattern.id)}
                                                className="mt-1 mr-3"
                                            />
                                            <div>
                                                <p className="font-semibold text-gray-900">{pattern.name}</p>
                                                <p className="text-sm text-gray-600">{pattern.description}</p>
                                            </div>
                                        </label>
                                    ))}
                                </div>
                            )}
                            {!design.interventionLevel && (
                                <p className="text-gray-600 italic">Please select an intervention level first.</p>
                            )}
                        </div>
                    )
                },
                {
                    title: 'Beautiful Design Check',
                    component: (
                        <div>
                            <p className="text-gray-700 mb-6">
                                Rate your design on these four dimensions (0 = very poor, 100 = excellent):
                            </p>
                            <div className="space-y-6">
                                {[
                                    { key: 'legibility', label: 'Legibility', question: 'How clear and understandable?' },
                                    { key: 'capacityRevealing', label: 'Capacity-Revealing', question: 'Does it show new possibilities?' },
                                    { key: 'authenticity', label: 'Authenticity', question: 'Will people recognize themselves?' },
                                    { key: 'implementability', label: 'Implementability', question: 'Can this actually be done?' }
                                ].map(dimension => (
                                    <div key={dimension.key}>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            {dimension.label}: {dimension.question}
                                        </label>
                                        <div className="slider-container">
                                            <input
                                                type="range"
                                                min="0"
                                                max="100"
                                                value={design.beautyScores[dimension.key]}
                                                onChange={(e) => updateBeautyScore(dimension.key, e.target.value)}
                                                className="w-full"
                                            />
                                            <div className="flex justify-between text-sm text-gray-600 mt-2">
                                                <span>0 (Poor)</span>
                                                <span className="font-bold text-purple-700 text-lg">
                                                    {design.beautyScores[dimension.key]}
                                                </span>
                                                <span>100 (Excellent)</span>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )
                },
                {
                    title: 'Risk Assessment',
                    component: (
                        <div>
                            <p className="text-gray-700 mb-4">
                                What could go wrong? Identify potential risks (check all that apply):
                            </p>
                            <div className="space-y-3 mb-6">
                                {[
                                    'Budget/resource constraints',
                                    'Political/leadership resistance',
                                    'Implementation difficulties',
                                    'Stakeholder pushback',
                                    'Unintended negative consequences',
                                    'Timeline too optimistic',
                                    'Cultural resistance',
                                    'Legal/policy barriers'
                                ].map(risk => (
                                    <label
                                        key={risk}
                                        className="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50"
                                    >
                                        <input
                                            type="checkbox"
                                            checked={design.risks.includes(risk)}
                                            onChange={() => toggleRisk(risk)}
                                            className="mr-3"
                                        />
                                        <span className="text-gray-700">{risk}</span>
                                    </label>
                                ))}
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Mitigation Strategy (optional):
                                </label>
                                <textarea
                                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                    rows="4"
                                    placeholder="How will you address these risks?"
                                    value={design.mitigation}
                                    onChange={(e) => updateDesign('mitigation', e.target.value)}
                                ></textarea>
                            </div>
                        </div>
                    )
                }
            ];

            const canProceed = () => {
                if (step === 0) return design.interventionLevel !== '';
                if (step === 1) return design.description.length >= 50;
                if (step === 2) return design.patterns.length > 0 || !design.interventionLevel;
                return true;
            };

            return (
                <div className="bg-white rounded-lg shadow-lg p-8">
                    <div className="mb-6">
                        <div className="flex justify-between items-center mb-2">
                            <h3 className="text-2xl font-bold text-gray-900">
                                Step {step + 1}/5: {steps[step].title}
                            </h3>
                            <span className="text-sm text-gray-600">
                                {Math.round((step / 5) * 100)}% Complete
                            </span>
                        </div>
                        <div className="w-full bg-gray-200 rounded-full h-2">
                            <div 
                                className="progress-bar bg-purple-600 h-2 rounded-full"
                                style={{width: `${(step / 5) * 100}%`}}
                            ></div>
                        </div>
                    </div>

                    <div className="mb-8">
                        {steps[step].component}
                    </div>

                    <div className="flex space-x-4">
                        {step > 0 && (
                            <button
                                onClick={() => setStep(step - 1)}
                                className="flex-1 bg-gray-200 text-gray-700 py-3 px-6 rounded-lg font-semibold hover:bg-gray-300 transition-colors"
                            >
                                â† Previous
                            </button>
                        )}
                        {step < steps.length - 1 ? (
                            <button
                                onClick={() => setStep(step + 1)}
                                disabled={!canProceed()}
                                className="flex-1 bg-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-purple-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"
                            >
                                Next Step â†’
                            </button>
                        ) : (
                            <button
                                onClick={onSubmit}
                                disabled={!canProceed()}
                                className="flex-1 bg-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-purple-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"
                            >
                                Submit Design â†’
                            </button>
                        )}
                    </div>
                </div>
            );
        }

        // Review Phase Component
        function ReviewPhase({ caseData, design, expertDesign, score, onNext, caseNumber, totalCases }) {
            const getLevelLabel = (level) => {
                const labels = {
                    context: 'Context Redesign',
                    capability: 'Capability Development',
                    constructor: 'Institutionalization',
                    metaconstructor: 'Learning Systems',
                    multi: 'Multi-Level Intervention'
                };
                return labels[level] || level;
            };

            return (
                <div className="space-y-6">
                    <div className="bg-white rounded-lg shadow-lg p-8">
                        <div className="flex items-center justify-between mb-6">
                            <h3 className="text-3xl font-bold text-gray-900">Expert Comparison</h3>
                            <div className="text-right">
                                <div className="text-sm text-gray-600">Your Score</div>
                                <div className="text-3xl font-bold text-purple-700">{score}/100</div>
                            </div>
                        </div>

                        <div className="grid md:grid-cols-2 gap-8 mb-8">
                            <div>
                                <h4 className="font-semibold text-gray-900 mb-4">Your Design</h4>
                                <div className="space-y-3">
                                    <div className="bg-gray-50 p-4 rounded-lg">
                                        <p className="text-sm text-gray-600 mb-1">Intervention Level</p>
                                        <p className="font-bold text-gray-900">
                                            {getLevelLabel(design.interventionLevel)}
                                        </p>
                                    </div>
                                    <div className="bg-gray-50 p-4 rounded-lg">
                                        <p className="text-sm text-gray-600 mb-2">Description</p>
                                        <p className="text-sm text-gray-700">{design.description}</p>
                                    </div>
                                    <div className="bg-gray-50 p-4 rounded-lg">
                                        <p className="text-sm text-gray-600 mb-2">Patterns Used</p>
                                        <p className="text-sm text-gray-700">
                                            {design.patterns.length > 0 ? design.patterns.join(', ') : 'None selected'}
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <h4 className="font-semibold text-gray-900 mb-4">Expert Design</h4>
                                <div className="space-y-3">
                                    <div className="bg-blue-50 p-4 rounded-lg">
                                        <p className="text-sm text-gray-600 mb-1">Intervention Level</p>
                                        <p className="font-bold text-gray-900 flex items-center">
                                            {getLevelLabel(expertDesign.interventionLevel)}
                                            <span className="ml-2 text-lg">
                                                {design.interventionLevel === expertDesign.interventionLevel ? 'âœ“' : 'âœ—'}
                                            </span>
                                        </p>
                                    </div>
                                    <div className="bg-blue-50 p-4 rounded-lg">
                                        <p className="text-sm text-gray-600 mb-2">Description</p>
                                        <p className="text-sm text-gray-700">{expertDesign.expertDescription}</p>
                                    </div>
                                    <div className="bg-blue-50 p-4 rounded-lg">
                                        <p className="text-sm text-gray-600 mb-2">Recommended Patterns</p>
                                        <p className="text-sm text-gray-700">
                                            {expertDesign.recommendedPatterns.join(', ')}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="bg-gray-50 p-6 rounded-lg mb-6">
                            <h4 className="font-semibold text-gray-900 mb-3">Your Beauty Scores vs Expert Ranges</h4>
                            <div className="space-y-3">
                                {Object.keys(design.beautyScores).map(dimension => {
                                    const labels = {
                                        legibility: 'Legibility',
                                        capacityRevealing: 'Capacity-Revealing',
                                        authenticity: 'Authenticity',
                                        implementability: 'Implementability'
                                    };
                                    const yourScore = design.beautyScores[dimension];
                                    const expertRange = expertDesign.beautyRanges[dimension];
                                    const inRange = yourScore >= expertRange[0] && yourScore <= expertRange[1];
                                    
                                    return (
                                        <div key={dimension}>
                                            <div className="flex justify-between items-center mb-1">
                                                <span className="text-sm font-medium text-gray-700">{labels[dimension]}</span>
                                                <span className="text-sm">
                                                    You: {yourScore} | Expert: {expertRange[0]}-{expertRange[1]}
                                                    <span className={`ml-2 ${inRange ? 'text-green-600' : 'text-yellow-600'}`}>
                                                        {inRange ? 'âœ“' : 'âš '}
                                                    </span>
                                                </span>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>

                    <div className="bg-white rounded-lg shadow-lg p-8">
                        <h4 className="text-xl font-bold text-gray-900 mb-4">Expert Analysis</h4>
                        
                        <div className="mb-6">
                            <h5 className="font-semibold text-gray-900 mb-2">Reasoning:</h5>
                            <p className="text-gray-700 whitespace-pre-line">{expertDesign.reasoning}</p>
                        </div>

                        <div className="bg-yellow-50 border-l-4 border-yellow-500 p-6 mb-6">
                            <h5 className="font-semibold text-yellow-900 mb-2">Common Mistake to Avoid:</h5>
                            <p className="text-gray-700">{expertDesign.commonMistake}</p>
                        </div>

                        <div className="bg-blue-50 border-l-4 border-blue-500 p-6">
                            <h5 className="font-semibold text-blue-900 mb-2">Implementation Notes:</h5>
                            <p className="text-gray-700">{expertDesign.implementationNotes}</p>
                        </div>
                    </div>

                    <div className="bg-white rounded-lg shadow-lg p-8">
                        <button
                            onClick={onNext}
                            className="w-full bg-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-purple-700 transition-colors"
                        >
                            {caseNumber < totalCases ? 'Next Case â†’' : 'Continue to Pattern Recognition â†’'}
                        </button>
                    </div>
                </div>
            );
        }

        // Pattern Recognition Game Component
        function PatternRecognitionGame({ questions, onComplete }) {
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [selectedLevel, setSelectedLevel] = useState(null);
            const [selectedPatterns, setSelectedPatterns] = useState([]);
            const [showFeedback, setShowFeedback] = useState(false);
            const [answers, setAnswers] = useState([]);

            const currentQuestion = questions[currentQuestionIndex];
            const isCorrect = selectedLevel === currentQuestion.correctLevel;

            const handleSubmit = () => {
                const newAnswers = [...answers, {
                    questionId: currentQuestion.id,
                    selectedLevel,
                    selectedPatterns,
                    correctLevel: currentQuestion.correctLevel,
                    correctPatterns: currentQuestion.correctPatterns,
                    isCorrect
                }];
                setAnswers(newAnswers);
                setShowFeedback(true);
            };

            const handleNext = () => {
                if (currentQuestionIndex < questions.length - 1) {
                    setCurrentQuestionIndex(currentQuestionIndex + 1);
                    setSelectedLevel(null);
                    setSelectedPatterns([]);
                    setShowFeedback(false);
                } else {
                    const score = answers.filter(a => a.isCorrect).length + (isCorrect ? 1 : 0);
                    onComplete({
                        answers: [...answers, {
                            questionId: currentQuestion.id,
                            selectedLevel,
                            correctLevel: currentQuestion.correctLevel,
                            isCorrect
                        }],
                        score,
                        total: questions.length
                    });
                }
            };

            const levelOptions = [
                { value: 'context', label: 'Context Redesign' },
                { value: 'capability', label: 'Capability Development' },
                { value: 'constructor', label: 'Institutionalization' },
                { value: 'metaconstructor', label: 'Learning Systems' }
            ];

            return (
                <div className="bg-white rounded-lg shadow-lg p-8">
                    <div className="mb-6">
                        <div className="flex justify-between items-center mb-2">
                            <h3 className="text-2xl font-bold text-gray-900">Pattern Recognition</h3>
                            <span className="text-sm text-gray-600">
                                Question {currentQuestionIndex + 1} of {questions.length}
                            </span>
                        </div>
                        <div className="w-full bg-gray-200 rounded-full h-2">
                            <div 
                                className="progress-bar bg-purple-600 h-2 rounded-full"
                                style={{width: `${((currentQuestionIndex + 1) / questions.length) * 100}%`}}
                            ></div>
                        </div>
                    </div>

                    <div className="bg-gray-50 p-6 rounded-lg mb-6">
                        <h4 className="font-semibold text-gray-900 mb-3">Scenario:</h4>
                        <p className="text-gray-700">{currentQuestion.scenario}</p>
                    </div>

                    {!showFeedback ? (
                        <>
                            <div className="mb-6">
                                <h5 className="font-semibold text-gray-900 mb-3">
                                    What intervention level is needed?
                                </h5>
                                <div className="space-y-3">
                                    {levelOptions.map(option => (
                                        <label
                                            key={option.value}
                                            className={`flex items-center p-4 border-2 rounded-lg cursor-pointer transition-colors ${
                                                selectedLevel === option.value
                                                    ? 'border-purple-500 bg-purple-50'
                                                    : 'border-gray-200 hover:border-gray-300'
                                            }`}
                                        >
                                            <input
                                                type="radio"
                                                name="level"
                                                value={option.value}
                                                checked={selectedLevel === option.value}
                                                onChange={(e) => setSelectedLevel(e.target.value)}
                                                className="mr-3"
                                            />
                                            <span className="font-medium text-gray-900">{option.label}</span>
                                        </label>
                                    ))}
                                </div>
                            </div>

                            <button
                                onClick={handleSubmit}
                                disabled={!selectedLevel}
                                className="w-full bg-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-purple-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"
                            >
                                Submit Answer
                            </button>
                        </>
                    ) : (
                        <>
                            <div className={`p-6 rounded-lg mb-6 ${
                                isCorrect ? 'bg-green-50 border-2 border-green-500' : 'bg-red-50 border-2 border-red-500'
                            }`}>
                                <div className="flex items-center mb-3">
                                    <span className="text-3xl mr-3">{isCorrect ? 'âœ“' : 'âœ—'}</span>
                                    <h4 className={`text-xl font-bold ${
                                        isCorrect ? 'text-green-900' : 'text-red-900'
                                    }`}>
                                        {isCorrect ? 'Correct!' : 'Not Quite'}
                                    </h4>
                                </div>
                                {!isCorrect && (
                                    <p className="text-gray-700 mb-2">
                                        The correct answer is: <strong>
                                            {levelOptions.find(o => o.value === currentQuestion.correctLevel)?.label}
                                        </strong>
                                    </p>
                                )}
                                <p className="text-gray-700 mb-3">{currentQuestion.explanation}</p>
                                <div className="bg-white p-3 rounded mt-3">
                                    <p className="text-sm font-semibold text-gray-600 mb-1">Recommended Patterns:</p>
                                    <p className="text-sm text-gray-700">{currentQuestion.correctPatterns.join(', ')}</p>
                                </div>
                            </div>

                            <button
                                onClick={handleNext}
                                className="w-full bg-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-purple-700 transition-colors"
                            >
                                {currentQuestionIndex < questions.length - 1 ? 'Next Question â†’' : 'View Results â†’'}
                            </button>
                        </>
                    )}
                </div>
            );
        }

        // Completion Screen Component
        function CompletionScreen({ studentInfo, sessionData }) {
            const designAverage = Math.round(
                sessionData.designs.reduce((sum, d) => sum + d.score, 0) / sessionData.designs.length
            );
            const patternScore = sessionData.patternRecognition.score;
            const patternTotal = sessionData.patternRecognition.answers.length;
            const patternPercentage = Math.round((patternScore / patternTotal) * 100);
            
            const finalScore = Math.round(designAverage * 0.7 + patternPercentage * 0.2 + 10);
            const passed = finalScore >= 75;

            const skillLevels = {
                context: determineSkillLevel(
                    Math.round(sessionData.designs.filter(d => 
                        EXPERT_DESIGNS[d.caseId].interventionLevel === 'context'
                    ).reduce((sum, d) => sum + d.score, 0) / 
                    Math.max(1, sessionData.designs.filter(d => EXPERT_DESIGNS[d.caseId].interventionLevel === 'context').length))
                ),
                capability: determineSkillLevel(
                    Math.round(sessionData.designs.filter(d => 
                        EXPERT_DESIGNS[d.caseId].interventionLevel === 'capability'
                    ).reduce((sum, d) => sum + d.score, 0) / 
                    Math.max(1, sessionData.designs.filter(d => EXPERT_DESIGNS[d.caseId].interventionLevel === 'capability').length))
                ),
                constructor: determineSkillLevel(
                    Math.round(sessionData.designs.filter(d => 
                        EXPERT_DESIGNS[d.caseId].interventionLevel === 'constructor'
                    ).reduce((sum, d) => sum + d.score, 0) / 
                    Math.max(1, sessionData.designs.filter(d => EXPERT_DESIGNS[d.caseId].interventionLevel === 'constructor').length))
                ),
                metaconstructor: determineSkillLevel(
                    Math.round(sessionData.designs.filter(d => 
                        EXPERT_DESIGNS[d.caseId].interventionLevel === 'metaconstructor'
                    ).reduce((sum, d) => sum + d.score, 0) / 
                    Math.max(1, sessionData.designs.filter(d => EXPERT_DESIGNS[d.caseId].interventionLevel === 'metaconstructor').length))
                )
            };

            const generateDocument = () => {
                const getLevelLabel = (level) => {
                    const labels = {
                        context: 'Context Redesign',
                        capability: 'Capability Development',
                        constructor: 'Institutionalization',
                        metaconstructor: 'Learning Systems',
                        multi: 'Multi-Level'
                    };
                    return labels[level] || level;
                };

                const doc = `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    MODULE 3: DESIGN STUDIO
    Completion Document
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Student Information:
  Name:           ${studentInfo.name}
  Email:          ${studentInfo.email}
  Course:         ${studentInfo.course}

Completion Details:
  Completed:      ${new Date(sessionData.completionTime).toLocaleString()}
  Session ID:     ${sessionData.sessionId}
  Started:        ${new Date(sessionData.startTime).toLocaleString()}
  Total Time:     ${Math.round((new Date(sessionData.completionTime) - new Date(sessionData.startTime)) / 60000)} minutes

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PERFORMANCE SUMMARY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Overall Score:         ${finalScore}%
Required Threshold:    75%
Status:               ${passed ? 'âœ“ PASSED' : 'âœ— DID NOT PASS'}

Design Exercises:      ${sessionData.designs.length}/${DESIGN_CASES.length} completed
Design Avg Score:      ${designAverage}/100
Pattern Recognition:   ${patternScore}/${patternTotal} correct (${patternPercentage}%)

Intervention Design Skill Assessment:
  Context Redesign:          ${skillLevels.context}
  Capability Development:    ${skillLevels.capability}
  Institutionalization:      ${skillLevels.constructor}
  Learning Systems:          ${skillLevels.metaconstructor}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
DESIGN EXERCISE BREAKDOWN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

${sessionData.designs.map((result, idx) => {
    const expert = EXPERT_DESIGNS[result.caseId];
    return `
CASE ${idx + 1}: ${result.title}
  Score: ${result.score}/100
  
  Your Intervention Level: ${getLevelLabel(result.design.interventionLevel)}
  Expert Level: ${getLevelLabel(expert.interventionLevel)}
  Match: ${result.design.interventionLevel === expert.interventionLevel ? 'âœ“' : 'âœ—'}
  
  Your Description:
  "${result.design.description}"
  
  Patterns Used: ${result.design.patterns.length > 0 ? result.design.patterns.join(', ') : 'None'}
  Expert Recommended: ${expert.recommendedPatterns.join(', ')}
  
  Beauty Scores:
    Legibility:         ${result.design.beautyScores.legibility} (Expert: ${expert.beautyRanges.legibility[0]}-${expert.beautyRanges.legibility[1]})
    Capacity-Revealing: ${result.design.beautyScores.capacityRevealing} (Expert: ${expert.beautyRanges.capacityRevealing[0]}-${expert.beautyRanges.capacityRevealing[1]})
    Authenticity:       ${result.design.beautyScores.authenticity} (Expert: ${expert.beautyRanges.authenticity[0]}-${expert.beautyRanges.authenticity[1]})
    Implementability:   ${result.design.beautyScores.implementability} (Expert: ${expert.beautyRanges.implementability[0]}-${expert.beautyRanges.implementability[1]})
  
  Risks Identified: ${result.design.risks.length > 0 ? result.design.risks.join('; ') : 'None'}
  ${result.design.mitigation ? `Mitigation: "${result.design.mitigation}"` : 'No mitigation strategy provided'}
  
  Time Spent: ${Math.round((new Date(result.endTime) - new Date(result.startTime)) / 60000)} minutes

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`;
}).join('\n')}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PATTERN RECOGNITION ASSESSMENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Score: ${patternScore}/${patternTotal} correct (${patternPercentage}%)

${sessionData.patternRecognition.answers.map((answer, idx) => {
    const labels = {
        context: 'Context Redesign',
        capability: 'Capability Development',
        constructor: 'Institutionalization',
        metaconstructor: 'Learning Systems'
    };
    return `Question ${idx + 1}: ${answer.isCorrect ? 'âœ“ Correct' : `âœ— Incorrect (Selected: ${labels[answer.selectedLevel]}, Correct: ${labels[answer.correctLevel]})`}`;
}).join('\n')}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
VERIFICATION & INTEGRITY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

This completion document was automatically generated by
the Ethical Design Studio Module 3.

Document Generated: ${new Date().toLocaleString()}
Unique Session ID:  ${sessionData.sessionId}
Version:           Module 3 v1.0

Time Tracking:
  Started:    ${new Date(sessionData.startTime).toLocaleString()}
  Completed:  ${new Date(sessionData.completionTime).toLocaleString()}
  Total Time: ${Math.round((new Date(sessionData.completionTime) - new Date(sessionData.startTime)) / 60000)} minutes

Cases Completed in Order:
${sessionData.designs.map((d, idx) => 
    `  Case ${idx + 1}: ${new Date(d.startTime).toLocaleTimeString()} - ${new Date(d.endTime).toLocaleTimeString()} (${Math.round((new Date(d.endTime) - new Date(d.startTime)) / 60000)} minutes)`
).join('\n')}

Note: This document cannot be regenerated with different
scores. Any modification will be evident upon inspection.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

For Instructor Use:
  Student met the 75% threshold: ${passed ? 'YES' : 'NO'}
  Recommended Grade: ${passed ? 'Pass/Satisfactory' : 'Incomplete - Requires Resubmission'}
  
  This document demonstrates ${passed ? 'completion' : 'attempted completion'} of Module 3:
  Design Studio and ${passed ? 'proficiency' : 'developing proficiency'} in designing
  ethical interventions at the appropriate level.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
End of Completion Document
Generated by Ethical Design Studio Module 3
`;
                return doc;
            };

            const downloadPDF = () => {
                const doc = generateDocument();
                const printWindow = window.open('', '', 'width=800,height=600');
                printWindow.document.write(`
                    <html>
                    <head>
                        <title>Module 3 Completion Document - ${studentInfo.name}</title>
                        <style>
                            body { font-family: 'Courier New', monospace; padding: 20px; font-size: 12px; line-height: 1.4; }
                            pre { white-space: pre-wrap; }
                        </style>
                    </head>
                    <body>
                        <pre>${doc}</pre>
                    </body>
                    </html>
                `);
                printWindow.document.close();
                setTimeout(() => {
                    printWindow.print();
                }, 250);
            };

            const copyToClipboard = () => {
                const doc = generateDocument();
                navigator.clipboard.writeText(doc);
                alert('Completion document copied to clipboard!');
            };

            return (
                <div className="fade-in max-w-3xl mx-auto space-y-6">
                    <div className={`rounded-lg shadow-lg p-8 ${
                        passed ? 'bg-green-50 border-2 border-green-500' : 'bg-yellow-50 border-2 border-yellow-500'
                    }`}>
                        <div className="flex items-center justify-between mb-6">
                            <div>
                                <h2 className="text-3xl font-bold text-gray-900 mb-2">
                                    {passed ? 'ðŸŽ‰ Congratulations!' : 'âš ï¸ Not Quite There'}
                                </h2>
                                <p className="text-lg text-gray-700">
                                    {passed 
                                        ? "You've completed Module 3: Design Studio!"
                                        : "You need 75% to pass. Please review and try again."
                                    }
                                </p>
                            </div>
                            <div className="text-center">
                                <div className="text-5xl font-bold text-purple-700">{finalScore}%</div>
                                <div className="text-sm text-gray-600">Final Score</div>
                            </div>
                        </div>

                        <div className="grid grid-cols-2 gap-4">
                            <div className="bg-white p-4 rounded-lg">
                                <div className="text-sm text-gray-600">Design Exercises</div>
                                <div className="text-2xl font-bold text-gray-900">
                                    {sessionData.designs.length}/{DESIGN_CASES.length}
                                </div>
                                <div className="text-sm text-gray-600">Avg: {designAverage}/100</div>
                            </div>
                            <div className="bg-white p-4 rounded-lg">
                                <div className="text-sm text-gray-600">Pattern Recognition</div>
                                <div className="text-2xl font-bold text-gray-900">
                                    {patternScore}/{patternTotal}
                                </div>
                                <div className="text-sm text-gray-600">{patternPercentage}% correct</div>
                            </div>
                        </div>
                    </div>

                    <div className="bg-white rounded-lg shadow-lg p-8">
                        <h3 className="text-2xl font-bold text-gray-900 mb-6">Skill Assessment</h3>
                        <div className="space-y-4">
                            {Object.entries(skillLevels).map(([level, skill]) => {
                                const labels = {
                                    context: 'Context Redesign',
                                    capability: 'Capability Development',
                                    constructor: 'Institutionalization',
                                    metaconstructor: 'Learning Systems'
                                };
                                const colors = {
                                    'Proficient': 'bg-green-100 text-green-800',
                                    'Developing': 'bg-yellow-100 text-yellow-800',
                                    'Novice': 'bg-red-100 text-red-800'
                                };
                                return (
                                    <div key={level} className="flex justify-between items-center">
                                        <span className="font-medium text-gray-900">{labels[level]}</span>
                                        <span className={`px-3 py-1 rounded-full text-sm font-semibold ${colors[skill]}`}>
                                            {skill}
                                        </span>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    {passed && (
                        <div className="bg-white rounded-lg shadow-lg p-8">
                            <h3 className="text-2xl font-bold text-gray-900 mb-4">Download Your Completion Document</h3>
                            <p className="text-gray-700 mb-6">
                                Your completion document includes all your intervention designs, expert comparisons, 
                                reasoning, and verification information. Download and submit to your instructor.
                            </p>

                            <div className="bg-purple-50 p-6 rounded-lg mb-6">
                                <h4 className="font-semibold text-purple-900 mb-2">Document Includes:</h4>
                                <ul className="space-y-1 text-gray-700 text-sm">
                                    <li>âœ“ Overall score: {finalScore}% (Required: 75%)</li>
                                    <li>âœ“ All 5 intervention designs with expert comparisons</li>
                                    <li>âœ“ Your descriptions, patterns, and reasoning</li>
                                    <li>âœ“ Beauty scores and risk assessments</li>
                                    <li>âœ“ Pattern recognition results</li>
                                    <li>âœ“ Skill level assessment</li>
                                    <li>âœ“ Timestamp and session verification</li>
                                </ul>
                            </div>

                            <div className="space-y-3">
                                <button
                                    onClick={downloadPDF}
                                    className="w-full bg-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-purple-700 transition-colors flex items-center justify-center"
                                >
                                    <span className="mr-2">ðŸ“„</span> Download as PDF (Print)
                                </button>
                                <button
                                    onClick={copyToClipboard}
                                    className="w-full bg-gray-200 text-gray-700 py-3 px-6 rounded-lg font-semibold hover:bg-gray-300 transition-colors flex items-center justify-center"
                                >
                                    <span className="mr-2">ðŸ“‹</span> Copy to Clipboard
                                </button>
                            </div>
                        </div>
                    )}

                    {!passed && (
                        <div className="bg-white rounded-lg shadow-lg p-8">
                            <h3 className="text-2xl font-bold text-gray-900 mb-4">What to Do Next</h3>
                            <p className="text-gray-700 mb-4">
                                You scored {finalScore}% but need 75% to pass. Here's what we recommend:
                            </p>
                            <ul className="space-y-2 text-gray-700 mb-6">
                                <li>â€¢ Review expert designs for cases where you scored below 75</li>
                                <li>â€¢ Pay attention to intervention level matching</li>
                                <li>â€¢ Study the design pattern library more carefully</li>
                                <li>â€¢ Practice identifying which patterns fit which problems</li>
                                <li>â€¢ When ready, start a new session and try again</li>
                            </ul>
                            <button
                                onClick={() => {
                                    if (confirm('This will clear your current progress and start fresh. Continue?')) {
                                        localStorage.removeItem('module3Progress');
                                        window.location.reload();
                                    }
                                }}
                                className="w-full bg-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-purple-700 transition-colors"
                            >
                                Start New Session
                            </button>
                        </div>
                    )}

                    <div className="bg-gray-100 rounded-lg p-6 text-center text-sm text-gray-600">
                        <p>Session ID: {sessionData.sessionId}</p>
                        <p>Completed: {new Date(sessionData.completionTime).toLocaleString()}</p>
                    </div>
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
